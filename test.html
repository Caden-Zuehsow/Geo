<!doctype html>
<html>
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BPYMG0BNRP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BPYMG0BNRP');
  </script>

  <meta charset="utf-8" />
  <title>GeoBrawl â€” Map + Multiplayer + Street View</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

<style>
:root {
  --bg:#11284B;
  --text-light:#E8E8E8;
  --text-accent:#4A90D6;
  --panel:#1A355F;
  --panel-border:#0A1630;
  --button:#4A90D6;
  --button-hover:#2F6CB0;
}

body{
  font-family:system-ui,Arial;
  margin:0;
  padding:20px;
  background:var(--bg);
  display:flex;
  justify-content:center;
  color:var(--text-light);
}

#left{width:100%;max-width:500px;}

.panel{
  background:var(--panel);
  padding:14px;
  border-radius:12px;
  margin-bottom:16px;
  border:1px solid var(--panel-border);
  box-shadow:0 2px 6px rgba(0,0,0,0.35);
}

button{
  width:100%;
  background:var(--button);
  color:white;
  border:none;
  padding:10px 12px;
  border-radius:8px;
  font-size:1rem;
  font-weight:600;
  margin-top:8px;
  cursor:pointer;
  transition:0.2s;
}
button:hover{background:var(--button-hover);transform:translateY(-2px);}

#map,#guessMap{
  width:100%;
  height:300px;
  border-radius:8px;
  background:#0A1630;
}

#guesserStreetView{
  width:100%;
  height:280px;
  border-radius:8px;
  background:#000;
  margin-bottom:8px;
  overflow:hidden;
}

#waitingMessage{
  text-align:center;
  color:#9bb5ff;
  margin-bottom:8px;
}

@media (max-width:480px){
  #map,#guessMap,#guesserStreetView{height:240px;}
}
</style>
</head>

<body>
<div id="left">

<!-- Guesser panel -->
<div class="panel" id="guesserPanel" style="display:none;">
  <h3 style="color:var(--text-accent)">Guesser â€” Make your guess</h3>

  <!-- This container shows AD first, then Street View -->
  <div id="guesserStreetView"></div>

  <!-- Buffer message -->
  <div id="waitingMessage">Waiting for picker to pick spot...</div>

  <div id="guesserMapContainer">
    <div id="guessMap"></div>
  </div>

  <button id="submitGuessBtn" disabled>Submit Guess</button>
</div>

</div>

<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQHZHmpF-9_7jEixW8z_h_-zbImwnI3S0&callback=initMaps"></script>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<script>

const socket = io("geo-production-f14c.up.railway.app",{transports:["websocket"]});

const guesserPanel = document.getElementById('guesserPanel');
const guesserStreetViewDiv = document.getElementById('guesserStreetView');
const waitingMessage = document.getElementById('waitingMessage');
const guessMapDiv = document.getElementById('guessMap');

let guessMap, guesserPanorama=null;
let mySocketId=null, currentPickerId=null, players=[];

/* ------------------ AD LOADER ------------------ */
/* ðŸ”¥ Replace ONE LINE below with real AdSense later */
function loadWaitingAd(){
  guesserStreetViewDiv.innerHTML = `
    <iframe 
      src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&mute=1"
      allow="autoplay; encrypted-media"
      allowfullscreen
      style="width:100%; height:100%; border:none;">
    </iframe>
  `;
}
/* ------------------------------------------------ */

function initMaps(){
  guessMap = new google.maps.Map(guessMapDiv,{
    center:{lat:20,lng:0},
    zoom:2,
    gestureHandling:"greedy"
  });
}

socket.on("connect",()=>mySocketId=socket.id);

/* When you become guesser */
function showGuesserWaiting(){
  guesserPanel.style.display="";
  loadWaitingAd(); // show ad
  waitingMessage.style.display="block";
}

/* Picker selected spot â†’ remove ad, load Street View */
socket.on("startGuess",data=>{
  guesserStreetViewDiv.innerHTML="";
  waitingMessage.style.display="none";

  guesserPanorama = new google.maps.StreetViewPanorama(
    guesserStreetViewDiv,{
      position:{lat:data.lat,lng:data.lng},
      pov:{heading:0,pitch:0},
      zoom:1,
      disableDefaultUI:true,
      clickToGo:false,
      linksControl:false
    }
  );
});

/* New round â†’ show ad again */
socket.on("newRound",()=>{
  showGuesserWaiting();
});

/* Simulated event for testing */
setTimeout(()=>showGuesserWaiting(),1500);

</script>
</body>
</html>
