<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>GeoBrawl — Solo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="/geofavicon/favicon.ico" />

  <style>
    :root {
      --bg:#11284B;
      --panel:#1A355F;
      --accent:#4A90D6;
      --text:#E8E8E8;
    }

    body {
      margin:0;
      padding:20px;
      font-family:system-ui,Arial;
      color:var(--text);
      background:var(--bg);
      display:flex;
      justify-content:center;
    }

    #container {
      width:100%;
      max-width:520px;
    }

    h1 {
      text-align:center;
      color:var(--accent);
      margin-bottom:10px;
    }

    .panel {
      background:var(--panel);
      padding:14px;
      border-radius:12px;
      margin-bottom:14px;
    }

    button {
      width:100%;
      padding:10px;
      font-weight:600;
      border-radius:8px;
      border:none;
      cursor:pointer;
      background:var(--accent);
      color:white;
    }

    #streetView, #map {
      width:100%;
      height:260px;
      border-radius:8px;
      margin-bottom:8px;
    }

    .score {
      font-weight:600;
      margin-top:6px;
    }
  </style>
</head>

<body>
<div id="container">

  <h1>GeoBrawl — Solo</h1>

  <div class="panel">
    <button id="startBtn">Start New Game</button>
    <div class="score">Round: <span id="round">0</span></div>
    <div class="score">Score: <span id="score">0</span></div>
  </div>

  <div class="panel">
    <div id="streetView">Loading Street View…</div>
  </div>

  <div class="panel">
    <div id="map"></div>
  </div>

  <div class="panel" id="resultPanel" style="display:none;">
    <div id="resultText"></div>
  </div>

</div>

<!-- Google Maps API -->
<script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQHZHmpF-9_7jEixW8z_h_-zbImwnI3S0&libraries=geometry&callback=initSolo">
</script>

<script>
  // Solo mode JS — all in one file
  window.initSolo = function() {
    console.log("initSolo called — Google Maps API loaded");

    if (!google || !google.maps) {
      console.error("Google Maps API not available!");
      alert("Google Maps failed to load. Check your API key and internet connection.");
      return;
    }

    let pickerLatLng = null;
    let round = 0;
    let score = 0;

    const streetViewDiv = document.getElementById('streetView');
    const mapDiv = document.getElementById('map');
    const startBtn = document.getElementById('startBtn');
    const roundSpan = document.getElementById('round');
    const scoreSpan = document.getElementById('score');
    const resultPanel = document.getElementById('resultPanel');
    const resultText = document.getElementById('resultText');

    let svPanorama, map, marker;

    function startRound() {
      round++;
      roundSpan.textContent = round;
      resultPanel.style.display = 'none';

      // Pick random lat/lng
      const lat = (Math.random() - 0.5) * 180;
      const lng = (Math.random() - 0.5) * 360;
      pickerLatLng = { lat, lng };

      // Street View
      svPanorama = new google.maps.StreetViewPanorama(streetViewDiv, {
        position: pickerLatLng,
        pov: { heading: 0, pitch: 0 },
        zoom: 1,
        disableDefaultUI: true,
      });

      // Map
      map = new google.maps.Map(mapDiv, {
        center: { lat: 0, lng: 0 },
        zoom: 2,
      });

      if(marker) marker.setMap(null);
      marker = null;
    }

    startBtn.onclick = () => {
      startRound();

      map.addListener('click', e => {
        if(marker) marker.setMap(null);
        marker = new google.maps.Marker({
          position: { lat: e.latLng.lat(), lng: e.latLng.lng() },
          map: map
        });

        // Calculate distance
        const dist = google.maps.geometry.spherical.computeDistanceBetween(
          new google.maps.LatLng(e.latLng.lat(), e.latLng.lng()),
          new google.maps.LatLng(pickerLatLng.lat, pickerLatLng.lng)
        );

        // Update score
        const points = Math.max(0, 1000 - Math.round(dist / 1609.34));
        score += points;
        scoreSpan.textContent = score;

        resultText.innerHTML = `Distance: ${Math.round(dist)} m — Points: ${points}`;
        resultPanel.style.display = '';
      });
    };
  };
</script>

</body>
</html>

